<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GDtools - Ultimate Hub</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <style>
        :root { --bg: #050505; --panel: #0f0f0f; --accent: #a855f7; --text: #ffffff; --text-dim: #71717a; --border: #27272a; --secondary: #3b82f6; --wolfram: #ff7e00; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        .container { background: var(--panel); width: 95%; max-width: 1000px; margin: 20px 0; padding: 25px; border: 1px solid var(--border); border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: var(--accent); text-transform: uppercase; letter-spacing: 3px; margin: 0 0 15px 0; font-size: 1.8rem; text-align: center; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .full-width { grid-column: span 2; }
        
        button { background: #000; color: #fff; border: 1px solid var(--border); padding: 14px; font-weight: bold; cursor: pointer; border-radius: 4px; transition: 0.2s; text-transform: uppercase; font-size: 0.85rem; }
        button:hover { border-color: var(--accent); color: var(--accent); transform: translateY(-2px); }
        
        .btn-external { border-color: #333; color: #aaa; }
        .btn-external:hover { border-color: var(--secondary); color: var(--secondary); }
        .btn-wolfram { border-color: #444; color: var(--wolfram); }
        .btn-wolfram:hover { border-color: var(--wolfram); box-shadow: 0 0 15px rgba(255, 126, 0, 0.2); }

        input, select { background: #000; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 4px; width: 100%; box-sizing: border-box; outline: none; margin-bottom: 15px; }
        label { display: block; font-size: 0.75rem; color: var(--accent); margin-bottom: 5px; text-transform: uppercase; }

        .table-wrap { max-height: 450px; overflow-y: auto; border: 1px solid var(--border); background: #000; margin-top: 15px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; font-family: 'Consolas', monospace; }
        th { position: sticky; top: 0; background: #0a0a0a; color: var(--accent); padding: 12px; border-bottom: 1px solid var(--accent); text-align: left; }
        td { padding: 8px 10px; border-bottom: 1px solid var(--border); }
        
        .hidden { display: none !important; }
        .footer { margin-top: auto; padding: 20px; text-align: center; font-size: 0.8rem; color: var(--text-dim); border-top: 1px solid var(--border); width: 100%; }
        
        #mobile-warning { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        .help-section { margin-top: 20px; padding: 15px; border: 1px solid #333; border-radius: 6px; background: #0a0a0a; font-size: 0.8rem; color: #888; text-align: center; }
    </style>
</head>
<body>

<div id="mobile-warning" class="hidden">
    <h2>üì± –í–Ω–∏–º–∞–Ω–∏–µ</h2>
    <p>–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã <b>GDtools</b> –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω–µ –≤–∫–ª—é—á–∏—Ç–µ <b>"–í–µ—Ä—Å–∏—é –¥–ª—è –ü–ö"</b>.</p>
    <button onclick="document.getElementById('mobile-warning').classList.add('hidden')" style="margin-top: 20px; border-color: var(--accent);">–ü–æ–Ω—è—Ç–Ω–æ</button>
</div>

<div id="main-menu" class="container">
    <h1>GDtools</h1>
    <div class="menu-grid">
        <button onclick="showPage('editor-page')">GMD Checker / Editor</button>
        <button onclick="showPage('gap-page')">Gap Calculator</button>
        <button class="btn-external" onclick="window.open('https://zcb3-web.vercel.app/', '_blank')">ZCB3 Web</button>
        <button class="btn-external" onclick="window.open('https://conv.nattie.dev/', '_blank')">Macro Converter</button>
        <button class="btn-wolfram full-width" onclick="showPage('wolfram-page')">WolframAlpha Solver</button>
    </div>
</div>

<div id="wolfram-page" class="container hidden">
    <h1 style="color: var(--wolfram);">Wolfram Solver</h1>
    <div style="max-width: 600px; margin: 0 auto;">
        <label>–í–∞—à –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å</label>
        <input type="text" id="wolframInput" placeholder="lim x->0 sin(x)/x –∏–ª–∏ 10^10^10">
        <button onclick="solveWolfram()" style="width: 100%; background: var(--wolfram); color: #000;">–†–ï–®–ò–¢–¨ (WolframAlpha)</button>
    </div>
    <button style="width:100%; margin-top:30px; background:#18181b" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="gap-page" class="container hidden">
    <h1>Gap Calculator</h1>
    <div style="max-width: 500px; margin: 0 auto;">
        <label>–†–∞–∑–º–µ—Ä –≥–∞–ø–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 3.0001)</label>
        <input type="number" id="gapSize" step="0.0000000001" placeholder="3.0001">
        
        <label>–†–µ–∂–∏–º –≤–æ–ª–Ω—ã</label>
        <select id="gapMode">
            <option value="3">–û–±—ã—á–Ω–∞—è –≤–æ–ª–Ω–∞ (Gap - 3)</option>
            <option value="6">–ú–∏–Ω–∏ –≤–æ–ª–Ω–∞ (Gap - 6)</option>
        </select>

        <label>–°–∫–æ—Ä–æ—Å—Ç—å</label>
        <select id="gapSpeed">
            <option value="1">1x Speed</option>
            <option value="0.5">0.5x Speed</option>
            <option value="2">2x Speed</option>
            <option value="3">3x Speed</option>
            <option value="4">4x Speed</option>
        </select>

        <div style="margin-bottom: 15px;">
            <input type="checkbox" id="gapDash" style="width: auto; margin-right: 10px;">
            <label style="display: inline;">Dash Orb –∞–∫—Ç–∏–≤–µ–Ω? (FPS x2)</label>
        </div>

        <button onclick="calculateGap()" style="width: 100%; background: var(--accent); color: #000;">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å FPS</button>
        <div id="gapRes" style="text-align: center; font-size: 2rem; margin-top: 20px; color: var(--accent); font-weight: bold;"></div>
    </div>
    <button style="width:100%; margin-top:30px; background:#18181b" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="editor-page" class="container hidden">
    <h1>GMD Editor</h1>
    <div id="dropZone" class="file-zone" onclick="document.getElementById('fileIn').click()">
        –ö–ª–∏–∫–Ω–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å .gmd —Ñ–∞–π–ª
        <input type="file" id="fileIn" class="hidden" accept=".gmd" onchange="loadGMD(this)">
    </div>

    <div id="editor-ui" class="hidden">
        <div class="editor-header">
            <div><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" id="lvlName"></div>
            <div><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" id="lvlDesc"></div>
        </div>
        <input type="text" id="objSearch" placeholder="–ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ (ID, X, Y...)" oninput="renderObjects()">
        <div style="display: flex; gap: 10px;">
            <button onclick="addObject()" style="background: #111; border-color: #22c55e; flex: 1;">+ –ë–ª–æ–∫</button>
            <button onclick="saveGMD()" style="background: var(--accent); color: #000; flex: 2;">–°–û–•–†–ê–ù–ò–¢–¨ .GMD</button>
        </div>
        <div class="table-wrap">
            <table>
                <thead><tr><th>ID</th><th>X</th><th>Y</th><th>Scale</th><th>Rot</th><th></th></tr></thead>
                <tbody id="objList"></tbody>
            </table>
        </div>
        <div class="help-section">
            <strong>–ò–ù–°–¢–†–£–ö–¶–ò–Ø:</strong> –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å ID –æ–±—ä–µ–∫—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥ <b>Better Object Info</b> –≤ Geode.
        </div>
    </div>
    <button style="width:100%; margin-top:15px; background:#18181b" onclick="location.reload()">–ù–∞–∑–∞–¥</button>
</div>

<div class="footer">GDtools | –ê–≤—Ç–æ—Ä: <strong>HELFZz</strong> | Special Thanks:</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    window.onload = () => {
        if (/Android|iPhone|iPad/i.test(navigator.userAgent) || window.innerWidth < 800) {
            document.getElementById('mobile-warning').classList.remove('hidden');
        }
    };

    function showPage(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    // WOLFRAM LOGIC
    function solveWolfram() {
        const query = document.getElementById('wolframInput').value;
        if (!query) return;
        window.open(`https://www.wolframalpha.com/input/?i=${encodeURIComponent(query)}`, '_blank');
    }

    // GAP CALCULATOR LOGIC (–ü–û–õ–ù–´–ô)
    function calculateGap() {
        const gap = parseFloat(document.getElementById('gapSize').value);
        const minusValue = parseFloat(document.getElementById('gapMode').value);
        if (!gap || gap <= minusValue) return alert("–ì–∞–ø —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π –¥–ª—è —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞!");

        const speedMap = { "0.5": 0.75, "1": 0.9, "2": 1.1, "3": 1.35, "4": 1.65 };
        const spd = speedMap[document.getElementById('gapSpeed').value];
        
        let fps = (spd * 450000) / (gap - minusValue);
        if (document.getElementById('gapDash').checked) fps *= 2;

        document.getElementById('gapRes').innerText = Math.round(fps).toLocaleString() + " FPS";
    }

    // EDITOR LOGIC
    let currentObjects = [];
    let originalXML = null;

    async function loadGMD(input) {
        const file = input.files[0];
        if (!file) return;
        const text = await file.text();
        originalXML = new DOMParser().parseFromString(text, "text/xml");
        
        const getVal = (k) => {
            const el = Array.from(originalXML.getElementsByTagName('k')).find(x => x.textContent === k);
            return el ? el.nextElementSibling.textContent : "";
        };

        document.getElementById('lvlName').value = getVal('k2');
        document.getElementById('lvlDesc').value = getVal('k3');
        const k4 = getVal('k4');

        if (k4) {
            try {
                const bin = atob(k4.replace(/-/g, '+').replace(/_/g, '/'));
                const bytes = pako.inflate(new Uint8Array(bin.split('').map(c => c.charCodeAt(0))), { to: 'string' });
                currentObjects = bytes.split(';').filter(s => s.length > 5).map(s => {
                    const d = {};
                    s.split(',').forEach((v, i, a) => { if(i%2===0) d[v] = a[i+1]; });
                    return d;
                });
                document.getElementById('editor-ui').classList.remove('hidden');
                document.getElementById('dropZone').classList.add('hidden');
                renderObjects();
            } catch(e) { alert("–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —É—Ä–æ–≤–Ω—è!"); }
        }
    }

    function renderObjects() {
        const query = document.getElementById('objSearch').value.toLowerCase();
        const list = document.getElementById('objList');
        list.innerHTML = "";
        currentObjects.forEach((obj, idx) => {
            if (query && !JSON.stringify(obj).toLowerCase().includes(query)) return;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><input type="text" value="${obj['1']}" onchange="currentObjects[${idx}]['1']=this.value"></td>
                <td><input type="text" value="${obj['2']}" onchange="currentObjects[${idx}]['2']=this.value"></td>
                <td><input type="text" value="${obj['3']}" onchange="currentObjects[${idx}]['3']=this.value"></td>
                <td><input type="text" value="${obj['128'] || 1}" onchange="currentObjects[${idx}]['128']=this.value"></td>
                <td><input type="text" value="${obj['6'] || 0}" onchange="currentObjects[${idx}]['6']=this.value"></td>
                <td><button onclick="currentObjects.splice(${idx},1);renderObjects()" style="color:red;border:none;background:none;">‚úï</button></td>
            `;
            list.appendChild(row);
        });
    }

    function addObject() { currentObjects.push({"1":"1","2":"0","3":"0"}); renderObjects(); }

    function saveGMD() {
        const objStr = currentObjects.map(o => Object.entries(o).map(e => e.join(',')).join(',')).join(';') + ';';
        const compressed = pako.deflate(objStr);
        const b64 = btoa(String.fromCharCode.apply(null, compressed)).replace(/\+/g, '-').replace(/\//g, '_');
        
        const setVal = (k, v) => {
            const el = Array.from(originalXML.getElementsByTagName('k')).find(x => x.textContent === k);
            if(el) el.nextElementSibling.textContent = v;
        };

        setVal('k2', document.getElementById('lvlName').value);
        setVal('k3', document.getElementById('lvlDesc').value);
        setVal('k4', b64);

        const blob = new Blob([new XMLSerializer().serializeToString(originalXML)], {type: "text/xml"});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = document.getElementById('lvlName').value + ".gmd";
        a.click();
    }
</script>
</body>
</html>
